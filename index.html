import React, { useState, useEffect } from 'react';
import { Code2, ExternalLink, TrendingUp, Wallet, Send, Github, Mail } from 'lucide-react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

export default function Portfolio() {
  const [ethPrice, setEthPrice] = useState(null);
  const [balance, setBalance] = useState(null);
  const [portfolioValue, setPortfolioValue] = useState(null);
  const [chartData, setChartData] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const ethAddress = '0x10dE74EBDFa84f5e6390a1A61DEad8d491754039';
  const apiKey = 'KGCJ6B1CEYAEQTC3BPR42HVGNXNHFA1537';

  useEffect(() => {
    fetchData();
    const interval = setInterval(fetchData, 30000);
    return () => clearInterval(interval);
  }, []);

  const fetchData = async () => {
    try {
      setError(null);
      
      // Fetch ETH price first
      const priceRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd');
      if (!priceRes.ok) throw new Error('Failed to fetch ETH price');
      
      const priceData = await priceRes.json();
      const currentPrice = priceData.ethereum.usd;
      setEthPrice(currentPrice);

      // Fetch balance from Etherscan with API key
      const balanceUrl = `https://api.etherscan.io/api?module=account&action=balance&address=${ethAddress}&tag=latest&apikey=${apiKey}`;
      console.log('Fetching from:', balanceUrl);
      
      const balanceRes = await fetch(balanceUrl);
      if (!balanceRes.ok) throw new Error('Failed to fetch balance from Etherscan');
      
      const balanceData = await balanceRes.json();
      console.log('Balance API Response:', balanceData);
      
      // Check if we got a valid response
      if (balanceData.message === 'OK' && balanceData.result) {
        const ethBalance = parseFloat(balanceData.result) / 1e18;
        console.log('ETH Balance:', ethBalance);
        setBalance(ethBalance);
        
        const value = ethBalance * currentPrice;
        console.log('Portfolio Value:', value);
        setPortfolioValue(value);

        // Update chart data
        setChartData(prev => {
          const newData = [...prev, {
            time: new Date().toLocaleTimeString('en-US', { 
              hour: '2-digit', 
              minute: '2-digit' 
            }),
            value: value,
            price: currentPrice
          }];
          return newData.slice(-25);
        });
        
        setLoading(false);
      } else if (balanceData.message === 'NOTOK') {
        console.error('Etherscan API Error:', balanceData.result);
        setError(`API Error: ${balanceData.result}`);
        setLoading(false);
      } else {
        // Still set the data even if balance is 0
        setBalance(0);
        setPortfolioValue(0);
        setLoading(false);
      }
      
    } catch (err) {
      console.error('Error fetching data:', err);
      setError(`Failed to load: ${err.message}`);
      setLoading(false);
    }
  };

  const skills = [
    { name: 'Python', level: 90, color: 'bg-blue-500', gradient: 'from-blue-500 to-blue-600' },
    { name: 'C++', level: 85, color: 'bg-purple-500', gradient: 'from-purple-500 to-purple-600' },
    { name: 'JavaScript', level: 88, color: 'bg-yellow-500', gradient: 'from-yellow-500 to-yellow-600' }
  ];

  const projects = [
    {
      title: 'Buy/Sell Sessions Bot',
      description: 'Advanced Telegram bot for automated trading session management with real-time notifications, secure transaction handling, and user-friendly interface. Features include session tracking, automated alerts, and comprehensive analytics.',
      tags: ['Python', 'Telegram API', 'Automation', 'Database'],
      link: 'https://t.me/buysellsessionsbot',
      gradient: 'from-cyan-600 to-blue-600'
    }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
      {/* Animated background */}
      <div className="fixed inset-0 overflow-hidden pointer-events-none">
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse delay-700"></div>
      </div>

      <div className="relative">
        {/* Hero Section */}
        <header className="border-b border-slate-800/50 backdrop-blur-xl bg-slate-900/30">
          <div className="max-w-7xl mx-auto px-6 py-16">
            <div className="flex flex-col md:flex-row items-start md:items-center justify-between gap-8">
              <div>
                <div className="flex items-center gap-4 mb-4">
                  <div className="w-16 h-16 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-cyan-500/20">
                    <Code2 className="w-8 h-8 text-white" />
                  </div>
                  <div>
                    <h1 className="text-5xl md:text-6xl font-bold bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent">
                      Akash Portfolio
                    </h1>
                    <p className="text-slate-400 text-lg mt-2">Full Stack Developer & Blockchain Enthusiast</p>
                  </div>
                </div>
                <p className="text-slate-300 text-lg max-w-2xl leading-relaxed">
                  Building innovative solutions with Python, C++, and JavaScript. Specializing in automation, 
                  blockchain integration, and creating powerful tools for modern challenges.
                </p>
              </div>
              
              {/* Contact Links */}
              <div className="flex gap-4">
                <a
                  href="https://t.me/tgbakash"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="group flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white rounded-xl font-medium transition-all shadow-lg shadow-cyan-500/25 hover:shadow-cyan-500/40 hover:scale-105"
                >
                  <Send className="w-5 h-5" />
                  Contact Me
                </a>
              </div>
            </div>
          </div>
        </header>

        <div className="max-w-7xl mx-auto px-6 py-16 space-y-16">
          {/* Skills Section */}
          <section>
            <div className="flex items-center gap-3 mb-8">
              <div className="w-12 h-12 bg-gradient-to-br from-cyan-500/20 to-blue-600/20 rounded-xl flex items-center justify-center border border-cyan-500/30">
                <Code2 className="w-6 h-6 text-cyan-400" />
              </div>
              <h2 className="text-4xl font-bold text-white">Technical Expertise</h2>
            </div>
            
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {skills.map((skill, index) => (
                <div 
                  key={skill.name}
                  className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl p-8 border border-slate-700/50 hover:border-cyan-500/50 transition-all hover:shadow-lg hover:shadow-cyan-500/10 hover:scale-105"
                  style={{ animationDelay: `${index * 100}ms` }}
                >
                  <h3 className="text-2xl font-bold text-white mb-4">{skill.name}</h3>
                  <div className="relative">
                    <div className="w-full bg-slate-700/50 rounded-full h-4 overflow-hidden">
                      <div
                        className={`h-full bg-gradient-to-r ${skill.gradient} rounded-full transition-all duration-1000 ease-out shadow-lg`}
                        style={{ width: `${skill.level}%` }}
                      />
                    </div>
                    <span className="absolute -top-8 right-0 text-3xl font-bold text-cyan-400">
                      {skill.level}%
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Projects Section */}
          <section>
            <div className="flex items-center gap-3 mb-8">
              <div className="w-12 h-12 bg-gradient-to-br from-purple-500/20 to-pink-600/20 rounded-xl flex items-center justify-center border border-purple-500/30">
                <ExternalLink className="w-6 h-6 text-purple-400" />
              </div>
              <h2 className="text-4xl font-bold text-white">Featured Projects</h2>
            </div>

            <div className="grid grid-cols-1 gap-6">
              {projects.map((project, index) => (
                <div 
                  key={index}
                  className="group bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl p-8 border border-slate-700/50 hover:border-purple-500/50 transition-all hover:shadow-2xl hover:shadow-purple-500/20"
                >
                  <div className="flex flex-col md:flex-row justify-between items-start gap-6">
                    <div className="flex-1">
                      <h3 className="text-3xl font-bold text-white mb-4 group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-cyan-400 group-hover:to-purple-500 group-hover:bg-clip-text transition-all">
                        {project.title}
                      </h3>
                      <p className="text-slate-300 text-lg leading-relaxed mb-6">
                        {project.description}
                      </p>
                      <div className="flex flex-wrap gap-3">
                        {project.tags.map((tag) => (
                          <span 
                            key={tag}
                            className="px-4 py-2 bg-slate-700/50 text-cyan-300 rounded-lg text-sm font-medium border border-slate-600/50 hover:border-cyan-500/50 transition-colors"
                          >
                            {tag}
                          </span>
                        ))}
                      </div>
                    </div>
                    <a
                      href={project.link}
                      target="_blank"
                      rel="noopener noreferrer"
                      className={`flex items-center gap-3 px-8 py-4 bg-gradient-to-r ${project.gradient} hover:shadow-lg hover:shadow-cyan-500/30 text-white rounded-xl font-semibold transition-all hover:scale-105 whitespace-nowrap`}
                    >
                      View Project
                      <ExternalLink className="w-5 h-5" />
                    </a>
                  </div>
                </div>
              ))}
            </div>
          </section>

          {/* Portfolio Section */}
          <section>
            <div className="flex items-center gap-3 mb-8">
              <div className="w-12 h-12 bg-gradient-to-br from-green-500/20 to-emerald-600/20 rounded-xl flex items-center justify-center border border-green-500/30">
                <Wallet className="w-6 h-6 text-green-400" />
              </div>
              <h2 className="text-4xl font-bold text-white">Crypto Portfolio</h2>
            </div>
            
            <div className="bg-gradient-to-br from-slate-800/50 to-slate-900/50 backdrop-blur-sm rounded-2xl p-8 border border-slate-700/50">
              <div className="mb-8 p-6 bg-slate-900/50 rounded-xl border border-slate-700/50">
                <p className="text-sm text-slate-400 mb-2 font-medium">Ethereum Address</p>
                <p className="text-sm font-mono text-cyan-400 break-all tracking-wide">{ethAddress}</p>
              </div>

              {loading ? (
                <div className="text-center py-16">
                  <div className="animate-spin rounded-full h-16 w-16 border-4 border-slate-700 border-t-cyan-400 mx-auto"></div>
                  <p className="text-slate-400 mt-6 text-lg">Loading portfolio data...</p>
                </div>
              ) : error ? (
                <div className="text-center py-16">
                  <p className="text-red-400 text-lg">{error}</p>
                </div>
              ) : (
                <>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div className="bg-gradient-to-br from-blue-900/30 to-cyan-900/30 rounded-xl p-8 border border-blue-500/30 hover:border-blue-400/50 transition-all hover:shadow-lg hover:shadow-blue-500/20">
                      <p className="text-slate-400 text-sm mb-2 font-medium">ETH Balance</p>
                      <p className="text-4xl font-bold text-cyan-400">
                        {balance !== null ? balance.toFixed(6) : '0.000000'} ETH
                      </p>
                    </div>
                    <div className="bg-gradient-to-br from-green-900/30 to-emerald-900/30 rounded-xl p-8 border border-green-500/30 hover:border-green-400/50 transition-all hover:shadow-lg hover:shadow-green-500/20">
                      <p className="text-slate-400 text-sm mb-2 font-medium">ETH Price</p>
                      <p className="text-4xl font-bold text-green-400">
                        ${ethPrice ? ethPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '0.00'}
                      </p>
                    </div>
                    <div className="bg-gradient-to-br from-purple-900/30 to-pink-900/30 rounded-xl p-8 border border-purple-500/30 hover:border-purple-400/50 transition-all hover:shadow-lg hover:shadow-purple-500/20">
                      <p className="text-slate-400 text-sm mb-2 font-medium">Total Value</p>
                      <p className="text-4xl font-bold text-purple-400">
                        ${portfolioValue !== null ? portfolioValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '0.00'}
                      </p>
                    </div>
                  </div>

                  {chartData.length > 1 && (
                    <div className="bg-slate-900/50 rounded-xl p-8 border border-slate-700/50">
                      <h3 className="text-2xl font-semibold mb-6 flex items-center gap-3 text-white">
                        <TrendingUp className="w-6 h-6 text-cyan-400" />
                        Portfolio Value Trend
                      </h3>
                      <ResponsiveContainer width="100%" height={350}>
                        <LineChart data={chartData}>
                          <defs>
                            <linearGradient id="colorValue" x1="0" y1="0" x2="0" y2="1">
                              <stop offset="5%" stopColor="#06B6D4" stopOpacity={0.3}/>
                              <stop offset="95%" stopColor="#06B6D4" stopOpacity={0}/>
                            </linearGradient>
                          </defs>
                          <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                          <XAxis 
                            dataKey="time" 
                            stroke="#94A3B8"
                            style={{ fontSize: '14px' }}
                            tick={{ fill: '#94A3B8' }}
                          />
                          <YAxis 
                            stroke="#94A3B8"
                            style={{ fontSize: '14px' }}
                            tick={{ fill: '#94A3B8' }}
                            tickFormatter={(value) => `$${value.toFixed(2)}`}
                          />
                          <Tooltip
                            contentStyle={{
                              backgroundColor: '#0F172A',
                              border: '1px solid #334155',
                              borderRadius: '12px',
                              color: '#fff',
                              padding: '12px'
                            }}
                            formatter={(value) => [`$${Number(value).toFixed(2)}`, 'Portfolio Value']}
                            labelStyle={{ color: '#94A3B8' }}
                          />
                          <Line 
                            type="monotone" 
                            dataKey="value" 
                            stroke="#06B6D4" 
                            strokeWidth={3}
                            dot={{ fill: '#06B6D4', r: 5, strokeWidth: 2, stroke: '#0F172A' }}
                            activeDot={{ r: 7, strokeWidth: 2 }}
                            fill="url(#colorValue)"
                          />
                        </LineChart>
                      </ResponsiveContainer>
                    </div>
                  )}
                </>
              )}
            </div>
          </section>
        </div>

        {/* Footer */}
        <footer className="border-t border-slate-800/50 backdrop-blur-xl bg-slate-900/30 mt-24">
          <div className="max-w-7xl mx-auto px-6 py-12">
            <div className="flex flex-col md:flex-row justify-between items-center gap-6">
              <div className="text-center md:text-left">
                <h3 className="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent mb-2">
                  Akash Portfolio
                </h3>
                <p className="text-slate-400">Full Stack Developer & Blockchain Enthusiast</p>
              </div>
              
              <div className="flex items-center gap-4">
                <a
                  href="https://t.me/tgbakash"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2 px-6 py-3 bg-slate-800/50 hover:bg-cyan-500/20 text-slate-300 hover:text-cyan-400 rounded-xl transition-all border border-slate-700/50 hover:border-cyan-500/50"
                >
                  <Send className="w-5 h-5" />
                  <span className="font-medium">Telegram</span>
                </a>
              </div>
            </div>
            
            <div className="mt-8 pt-8 border-t border-slate-800/50 text-center text-slate-400">
              <p>Â© 2024 Akash Portfolio. All rights reserved.</p>
            </div>
          </div>
        </footer>
      </div>
    </div>
  );
}
